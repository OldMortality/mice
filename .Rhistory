celltype = "CD11cpos"
createDataplot(maleWT.mice,malePound.mice,main=str_c(celltype," male"),mice.df)
addMiceToPlot <- function(mice,df) {
for (i in 1:length(mice)) {
addMouseToPlot(mice[i],df)
}
}
addMeansToPlot <- function(df,theGroup,col) {
lines(x,apply(getPropsByMouse(df.mice,theGroup),2,mean,na.rm=T),col=col,lty=10,lwd=4)
}
male.mice <- df.mice[which(!df.mice$female),]
maleWT.mice <-
which(!df.mice$female & df.mice$type == "WT")
malePound.mice <-
which(!df.mice$female & df.mice$type == "Pound")
female.mice <- df.mice[which(df.mice$female),]
femaleWT.mice <-
which(df.mice$female & df.mice$type == "WT")
femalePound.mice <-
which(df.mice$female & df.mice$type == "Pound")
createDataplot <- function(g1,g2,main,df) {
{
plot('',xlim=c(0,24),ylim=c(0,0.4),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,
24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(g1,df)
addMiceToPlot(g2,df)
}
addMeansToPlot(df,g1,'black')
addMeansToPlot(df,g2,'red')
}
par(mfrow=c(1,1))
celltype = "CD11cpos"
createDataplot(maleWT.mice,malePound.mice,main=str_c(celltype," male"),mice.df)
createDataplot <- function(g1,g2,main,df) {
{
plot('',xlim=c(0,24),ylim=c(0,0.1),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,
24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(g1,df)
addMiceToPlot(g2,df)
}
addMeansToPlot(df,g1,'black')
addMeansToPlot(df,g2,'red')
}
createDataplot <- function(g1,g2,main,df,ylim) {
{
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,
24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(g1,df)
addMiceToPlot(g2,df)
}
addMeansToPlot(df,g1,'black')
addMeansToPlot(df,g2,'red')
}
createDataplot(maleWT.mice,malePound.mice,main=str_c(celltype," male"),mice.df,ylim=0.1)
rm(list = ls())
library(stringr)
library(lme4)
setwd("~/Documents/mice")
source('createMatrix.R')
mice <- read.csv("~/Documents/mice/data/mice.csv",header=TRUE)[1:40,]
mice.s <- read.csv("~/Documents/mice/data/mice2.csv",header=TRUE)[1:40,]
stroke_size <- scale(mice.s$stroke_size)
{
mice$female <- grepl('female',mice$Animal_type)
mice$type_1 <- grepl('PLT',mice$Animal_type)
mice$type_2 <- grepl('Pound',
mice$Animal_type)
mice$type <- 'WT'
mice[which(mice$type_1),"type"] <- 'PLT'
mice[which(mice$type_2),"type"] <- 'T2'
celltype <- "CD19pos_B220"
# number of mice
N <- dim(mice)[1]
# number of time periods (0,3,10,17,24)
# these are labeled 1 through to 5
periods <- 5
mice <- mice[-which(mice$type=='PLT'),]
table(mice$type)
# N_0 <- mice$Live_cells_0
# R_0 <- mice$CD19pos_B220pos_0
# N_3 <- mice$Live_cells_3
# R_3 <- mice$CD19pos_B220pos_3
# N_10 <- mice$Live_cells_10
# R_10 <- mice$CD19pos_B220pos_10
# N_17 <- mice$Live_cells_17
# R_17 <- mice$CD19pos_B220pos_17
# N_24 <- mice$Live_cells_24
# R_24 <- mice$CD19pos_B220pos_24
female <- grepl('female',mice$Animal_type)
type_1 <- grepl('PLT',mice$Animal_type)
type_2 <- grepl('Pound',mice$Animal_type)
celltype <- "CD11cpos"
N_matrix <- getNMatrix(mice,celltype)
R_matrix <- getRMatrix(mice,celltype)
# long notation (i.e. observations as rows)
per_long <- vector()
mouse_long <- vector()
female_long <- vector()
type_1_long <- vector()
type_2_long <- vector()
N_long <- vector()
R_long <- vector()
stroke_size_long <- vector()
counter = 0
skipped = 0
for (i in 1: N) {
for (j in 1:5) {
if (is.na(N_matrix[i,j])) {
skipped <- skipped + 1
next
} else {
counter <- counter + 1
}
# periods run from [1,5] ~ [0,3,10,17,24]
per_long[counter]    <- j
mouse_long[counter]  <- str_c('mouse',i,sep='')
female_long[counter] <- female[i]
type_1_long[counter] <- type_1[i]
type_2_long[counter] <- type_2[i]
stroke_size_long[counter] <- stroke_size[i]
N_long[counter]      <- N_matrix[i,j]
R_long[counter]      <- R_matrix[i,j]
}
}
}
mice2 <- data.frame(
y = R_long / N_long,
period = factor(per_long),
mouse = mouse_long,
female = female_long,
type1 = type_1_long,
type2 = type_2_long,
stroke_size = stroke_size_long
)
head(mice2)
mice2$type <- "WT"
mice2[which(mice2$type2),"type"] <- "T2"
mice2$type1 <- NULL
mice2$type2 <- NULL
head(mice2)
table(mice2$type)
m <- lmer(y~stroke_size + type + factor(period) * female +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
celltype
mice2$y
mice2 <- mice2[-which(mice2$female),]
head(mice2)
dim(mice2)
m <- lmer(y~stroke_size + type * factor(period) +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
library(glmmTMB)
m.beta <- glmmTMB(y~type * factor(period)  + (1|mouse),
data=mice2, family=list(family="beta",link="logit"))
s <- summary(m.beta)
CI_lower <- s$coefficients$cond[,2] - 1.96*s$coefficients$cond[,2]
CI_upper <- s$coefficients$cond[,2] + 1.96*s$coefficients$cond[,2]
cbind(exp(CI_lower),exp(CI_upper))
s <- summary(m.beta)
CI_lower <- s$coefficients$cond[,2] - 1.67*s$coefficients$cond[,2]
CI_upper <- s$coefficients$cond[,2] + 1.67*s$coefficients$cond[,2]
cbind(exp(CI_lower),exp(CI_upper))
qnorm(0.025)
qnorm(0.1)
s <- summary(m.beta)
CI_lower <- s$coefficients$cond[,2] - 1.28*s$coefficients$cond[,2]
CI_upper <- s$coefficients$cond[,2] + 1.28*s$coefficients$cond[,2]
cbind(exp(CI_lower),exp(CI_upper))
qnorm(0.125)
CI_lower <- s$coefficients$cond[,2] - 1.15*s$coefficients$cond[,2]
CI_upper <- s$coefficients$cond[,2] + 1.15*s$coefficients$cond[,2]
cbind(exp(CI_lower),exp(CI_upper))
s <- summary(m.beta)
CI_lower <- s$coefficients$cond[,2] - 1.67*s$coefficients$cond[,2]
CI_upper <- s$coefficients$cond[,2] + 1.67*s$coefficients$cond[,2]
cbind(exp(CI_lower),exp(CI_upper))
rm(list = ls())
library(stringr)
library(lme4)
setwd("~/Documents/mice")
source('createMatrix.R')
mice <- read.csv("~/Documents/mice/data/mice.csv",header=TRUE)[1:40,]
mice.s <- read.csv("~/Documents/mice/data/mice2.csv",header=TRUE)[1:40,]
stroke_size <- scale(mice.s$stroke_size)
{
mice$female <- grepl('female',mice$Animal_type)
mice$type_1 <- grepl('PLT',mice$Animal_type)
mice$type_2 <- grepl('Pound',
mice$Animal_type)
mice$type <- 'WT'
mice[which(mice$type_1),"type"] <- 'PLT'
mice[which(mice$type_2),"type"] <- 'T2'
celltype <- "CD19pos_B220"
# number of mice
N <- dim(mice)[1]
# number of time periods (0,3,10,17,24)
# these are labeled 1 through to 5
periods <- 5
mice <- mice[-which(mice$type=='PLT'),]
table(mice$type)
# N_0 <- mice$Live_cells_0
# R_0 <- mice$CD19pos_B220pos_0
# N_3 <- mice$Live_cells_3
# R_3 <- mice$CD19pos_B220pos_3
# N_10 <- mice$Live_cells_10
# R_10 <- mice$CD19pos_B220pos_10
# N_17 <- mice$Live_cells_17
# R_17 <- mice$CD19pos_B220pos_17
# N_24 <- mice$Live_cells_24
# R_24 <- mice$CD19pos_B220pos_24
female <- grepl('female',mice$Animal_type)
type_1 <- grepl('PLT',mice$Animal_type)
type_2 <- grepl('Pound',mice$Animal_type)
celltype <- "CD11cpos"
N_matrix <- getNMatrix(mice,celltype)
R_matrix <- getRMatrix(mice,celltype)
# long notation (i.e. observations as rows)
per_long <- vector()
mouse_long <- vector()
female_long <- vector()
type_1_long <- vector()
type_2_long <- vector()
N_long <- vector()
R_long <- vector()
stroke_size_long <- vector()
counter = 0
skipped = 0
for (i in 1: N) {
for (j in 1:5) {
if (is.na(N_matrix[i,j])) {
skipped <- skipped + 1
next
} else {
counter <- counter + 1
}
# periods run from [1,5] ~ [0,3,10,17,24]
per_long[counter]    <- j
mouse_long[counter]  <- str_c('mouse',i,sep='')
female_long[counter] <- female[i]
type_1_long[counter] <- type_1[i]
type_2_long[counter] <- type_2[i]
stroke_size_long[counter] <- stroke_size[i]
N_long[counter]      <- N_matrix[i,j]
R_long[counter]      <- R_matrix[i,j]
}
}
}
mice2 <- data.frame(
y = R_long / N_long,
period = factor(per_long),
mouse = mouse_long,
female = female_long,
type1 = type_1_long,
type2 = type_2_long,
stroke_size = stroke_size_long
)
head(mice2)
mice2$type <- "WT"
mice2[which(mice2$type2),"type"] <- "T2"
mice2$type1 <- NULL
mice2$type2 <- NULL
head(mice2)
table(mice2$type)
mice2 <- mice2[-which(mice2$female),]
head(mice2)
dim(mice2)
m <- lmer(y~stroke_size + type * factor(period) +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
mice2$type <- factor(mice2$type,ref='WT')
?factor
mice2$type <- factor(mice2$type)
relevels(mice2$type,ref='WT')
mice2$type <- factor(mice2$type)
relevel(mice2$type,ref='WT')
head(mice2)
table(mice2$type)
m <- lmer(y~stroke_size + type + factor(period) * female +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
mice2$type <- factor(mice2$type)
relevel(mice2$type,ref='WT')
mice2$type
m <- lmer(y~stroke_size + type + factor(period) * female +  (1|mouse) , data=mice2)
m <- lmer(y~ type + factor(period) * female +  (1|mouse) , data=mice2)
mice2 <- data.frame(
y = R_long / N_long,
period = factor(per_long),
mouse = mouse_long,
female = female_long,
type1 = type_1_long,
type2 = type_2_long,
stroke_size = stroke_size_long
)
rm(list = ls())
library(stringr)
library(lme4)
setwd("~/Documents/mice")
source('createMatrix.R')
mice <- read.csv("~/Documents/mice/data/mice.csv",header=TRUE)[1:40,]
mice.s <- read.csv("~/Documents/mice/data/mice2.csv",header=TRUE)[1:40,]
stroke_size <- scale(mice.s$stroke_size)
{
mice$female <- grepl('female',mice$Animal_type)
mice$type_1 <- grepl('PLT',mice$Animal_type)
mice$type_2 <- grepl('Pound',
mice$Animal_type)
mice$type <- 'WT'
mice[which(mice$type_1),"type"] <- 'PLT'
mice[which(mice$type_2),"type"] <- 'T2'
celltype <- "CD19pos_B220"
# number of mice
N <- dim(mice)[1]
# number of time periods (0,3,10,17,24)
# these are labeled 1 through to 5
periods <- 5
mice <- mice[-which(mice$type=='PLT'),]
table(mice$type)
# N_0 <- mice$Live_cells_0
# R_0 <- mice$CD19pos_B220pos_0
# N_3 <- mice$Live_cells_3
# R_3 <- mice$CD19pos_B220pos_3
# N_10 <- mice$Live_cells_10
# R_10 <- mice$CD19pos_B220pos_10
# N_17 <- mice$Live_cells_17
# R_17 <- mice$CD19pos_B220pos_17
# N_24 <- mice$Live_cells_24
# R_24 <- mice$CD19pos_B220pos_24
female <- grepl('female',mice$Animal_type)
type_1 <- grepl('PLT',mice$Animal_type)
type_2 <- grepl('Pound',mice$Animal_type)
celltype <- "CD11cpos"
N_matrix <- getNMatrix(mice,celltype)
R_matrix <- getRMatrix(mice,celltype)
# long notation (i.e. observations as rows)
per_long <- vector()
mouse_long <- vector()
female_long <- vector()
type_1_long <- vector()
type_2_long <- vector()
N_long <- vector()
R_long <- vector()
stroke_size_long <- vector()
counter = 0
skipped = 0
for (i in 1: N) {
for (j in 1:5) {
if (is.na(N_matrix[i,j])) {
skipped <- skipped + 1
next
} else {
counter <- counter + 1
}
# periods run from [1,5] ~ [0,3,10,17,24]
per_long[counter]    <- j
mouse_long[counter]  <- str_c('mouse',i,sep='')
female_long[counter] <- female[i]
type_1_long[counter] <- type_1[i]
type_2_long[counter] <- type_2[i]
stroke_size_long[counter] <- stroke_size[i]
N_long[counter]      <- N_matrix[i,j]
R_long[counter]      <- R_matrix[i,j]
}
}
}
mice2 <- data.frame(
y = R_long / N_long,
period = factor(per_long),
mouse = mouse_long,
female = female_long,
type1 = type_1_long,
type2 = type_2_long,
stroke_size = stroke_size_long
)
head(mice2)
mice2$type <- "WT"
mice2[which(mice2$type2),"type"] <- "T2"
mice2$type <- factor(mice2$type)
relevel(mice2$type,ref='WT')
head(mice2)
table(mice2$type)
m <- lmer(y~ type + factor(period) * female +  (1|mouse) , data=mice2)
mice2 <- mice2[-which(mice2$female),]
head(mice2)
dim(mice2)
m <- lmer(y~stroke_size + type * factor(period) +  (1|mouse) , data=mice2)
CI_lower <- s$coefficients[,2] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
CI_lower <- s$coefficients[,2] - 1.67*s$coefficients[,2]
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
s <- summary(m)
s
relevel(mice2$type,ref='WT')
m <- lmer(y~stroke_size + type * factor(period) +  (1|mouse) , data=mice2)
s <- summary(m)
s
mice2$type <- "WT"
mice2[which(mice2$type2),"type"] <- "T2"
relevel(mice2$type,ref='WT')
mice2$type <- factor(mice2$type)
relevel(mice2$type,ref='WT')
m <- lmer(y~stroke_size + type * factor(period) +  (1|mouse) , data=mice2)
s <- summary(m)
s
m <- lmer(y~ type +  (1|mouse) , data=mice2)
s <- summary(m)
s
mice2$type <- "aWT"
mice2[which(mice2$type2),"type"] <- "T2"
mice2$type <- factor(mice2$type)
m <- lmer(y~ type + factor(period) * female +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
m <- lmer(y~ type + factor(period) * female +  (1|mouse) , data=mice2)
s <- summary(m)
mice2 <- data.frame(
y = R_long / N_long,
period = factor(per_long),
mouse = mouse_long,
female = female_long,
type1 = type_1_long,
type2 = type_2_long,
stroke_size = stroke_size_long
)
mice2$type <- "aWT"
mice2[which(mice2$type2),"type"] <- "T2"
mice2$type <- factor(mice2$type)
m <- lmer(y~ type + factor(period) * female +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
mice2 <- mice2[-which(mice2$female),]
head(mice2)
dim(mice2)
m <- lmer(y~stroke_size + type * factor(period) +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,2] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
s <- summary(m)
s
CI_lower <- s$coefficients[,2] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
CI_lower <- s$coefficients[,2] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
qnorm(0.975)
CI_lower <- s$coefficients[,2] - 1*s$coefficients[,2]
CI_upper <- s$coefficients[,2] + 1*s$coefficients[,2]
cbind(CI_lower,CI_upper)
s <- summary(m)
CI_lower <- s$coefficients[,1] - 1.96*s$coefficients[,2]
CI_upper <- s$coefficients[,1] + 1.96*s$coefficients[,2]
cbind(CI_lower,CI_upper)
CI_lower <- s$coefficients[,1] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,1] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
m <- lmer(y~ type * factor(period) +  (1|mouse) , data=mice2)
s <- summary(m)
CI_lower <- s$coefficients[,1] - 1.67*s$coefficients[,2]
CI_upper <- s$coefficients[,1] + 1.67*s$coefficients[,2]
cbind(CI_lower,CI_upper)
CI_lower <- s$coefficients[,1] - 1*s$coefficients[,2]
CI_upper <- s$coefficients[,1] + 1*s$coefficients[,2]
cbind(CI_lower,CI_upper)
s
s$coefficients[,1]
cbind(CI_lower,CI_upper)
confint(m,level=0.9)
round(cbind(CI_lower,CI_upper),2)
round(confint(m,level=0.9),2)
