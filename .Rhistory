N_17 = NMatrix[,4],
R_17 = RMatrix[,4],
N_24 = NMatrix[,5],
R_24 = RMatrix[,5],
female = grepl('female',mice$Animal_type),
type_1 = grepl('PLT',mice$Animal_type),
type_2 = grepl('Pound',mice$Animal_type)
)
result$type <- 'WT'
result[which(result$type_1),"type"] <- 'PLT'
result[which(result$type_2),"type"] <- 'Pound'
result <- result[ , !(names(result) %in% c("type_1","type_2"))]
result$y0 <- result$R_0/result$N_0
result$y3 <- result$R_3/result$N_3
result$y10 <- result$R_10/result$N_10
result$y17 <- result$R_17/result$N_17
result$y24 <- result$R_24/result$N_24
return(result)
}
# return proportions for a give mouse row
getPropsByMouse <- function(df,id) {
return(df[id,c("y0","y3","y10","y17","y24")])
}
# returns type of given mouse row
getMouseType <- function(df,mouse) {
return(df$type[mouse])
}
# adds mouse to the plot
#  mouse is the row in the df
#  df would be df.props
addMouseToPlot <- function(mouse,df) {
col <- 'black'
pch <- 20
if (getMouseType(df,mouse) == "Pound") {
col <- 'red'
}
pts <- getPropsByMouse(df,mouse)
points(0,pts[1,1],col=col,pch=pch)
points(3,pts[1,2],col=col,pch=pch)
points(10,pts[1,3],col=col,pch=pch)
points(17,pts[1,4],col=col,pch=pch)
points(24,pts[1,5],col=col,pch=pch)
lines(x=c(0,3,10,17,24),y=pts,col=col,pch=pch)
print(paste(mouse,col,round(pts,2)))
}
x <- c(0,3,10,17,24)
addMiceToPlot <- function(mice,df) {
for (i in 1:length(mice)) {
addMouseToPlot(mice[i],df)
}
}
addMeansToPlot <- function(df,theGroup,col) {
lines(c(0,3,10,17,24),apply(getPropsByMouse(df,theGroup),2,mean,na.rm=T),col=col,lty=10,lwd=4)
}
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(g1,g2),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,g1,'black')
addMeansToPlot(df,g2,'red')
}
par(mfrow=c(1,1))
celltype
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[2]),maleWT.mice),2)
#male.mice <- df.props[which(!df.props$female),]
maleWT.mice <-
which(!df.props$female & df.props$type == "WT")
malePound.mice <-
which(!df.props$female & df.props$type == "Pound")
mice
mice$female
dim(mice)
#male.mice <- df.props[which(!df.props$female),]
df.props <- create.df(df = mice,celltype)
maleWT.mice <-
which(!df.props$female & df.props$type == "WT")
malePound.mice <-
which(!df.props$female & df.props$type == "Pound")
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[3]),maleWT.mice),2)
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[3]),malePound.mice),2)
celltypes[3]
celltypes[3]
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[3]),maleWT.mice),2)
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[3]),malePound.mice),2)
par(mfrow=c(1,1))
createDataplot(main = str_c(celltype),
df = create.df(df = mice,celltype)
)
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(g1,g2),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,maleWT.mice,'black')
addMeansToPlot(df,malePound,'red')
}
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(g1,g2),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,maleWT.mice,'black')
addMeansToPlot(df,malePound,'red')
}
celltype
C = 3
celltypes[C]
C = 3
celltypes[C]
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[C]),maleWT.mice),2)
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[C]),malePound.mice),2)
par(mfrow=c(1,1))
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
par(mfrow=c(1,1))
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(g1,g2),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,maleWT.mice,'black')
addMeansToPlot(df,malePound,'red')
}
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(maleWT.mice,malePound.mice),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,maleWT.mice,'black')
addMeansToPlot(df,malePound,'red')
}
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(maleWT.mice,malePound.mice),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,maleWT.mice,'black')
addMeansToPlot(df,malePound.mice,'red')
}
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
#
#
# 2019. Took this from mice.df.rmd.
#
#
rm(list = ls())
library(stringr)
library(lme4)
setwd("~/Documents/mice")
source('createMiceDF.R')
source('waldInterval.R')
mice = readFile(filename='data/mice.csv')
celltypes <- getcelltypes(mice)
# get data in long format
C = 3
celltypes[C]
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
head(mice.df)
celltypes[C]
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
head(mice.df)
mice=NULL
dim(mice.df)
# z-value for 95% CI
Z = 1.96
## linear model
m.lm <- lmer(y ~ type * factor(period) +  (1|mouse.name) , data=mice.df)
waldInterval(model=m.lm,Z,FUN=identity)
r <- residuals(m.lm)
##
## linear model on the logit scale
##
##
m.lm <- lmer(logity ~ type * factor(period) +  (1|mouse.name) , data=mice.df)
waldInterval(model=m.lm,Z=Z,FUN=exp)
# get data in long format
C = 4
celltypes[C]
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
head(mice.df)
mice=NULL
dim(mice.df)
# z-value for 95% CI
Z = 1.96
##
## linear model on the logit scale
##
##
m.lm <- lmer(logity ~ type * factor(period) +  (1|mouse.name) , data=mice.df)
waldInterval(model=m.lm,Z=Z,FUN=exp)
mice.df
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
head(mice.df)
##
## linear model on the logit scale
##
##
m.lm <- lmer(logity ~ type * factor(period) +  (1|mouse.name) , data=mice.df)
waldInterval(model=m.lm,Z=Z,FUN=exp)
mice.df
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
C
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
celltypes[C]
getSrcFilename(mice,'CD11c')
getNMatrix(mice,'CD11c')
getRMatrix(mice,'CD11c')
getRMatrix(df.mice,'CD11c')
getRMatrix(mice.df,'CD11c')
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
mice
mice = readFile(filename='data/mice.csv')
#
#
# 2019. Took this from mice.df.rmd.
#
#
rm(list = ls())
library(stringr)
library(lme4)
setwd("~/Documents/mice")
source('createMiceDF.R')
source('waldInterval.R')
mice = readFile(filename='data/mice.csv')
celltypes <- getcelltypes(mice)
# get data in long format
C = 4
celltypes[C]
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
head(mice.df)
mice=NULL
getRMatrix(mice.df,'CD11c')
mice.df$logity
##
## linear model on the logit scale
##
##
m.lm <- lmer(logity ~ type * factor(period) +  (1|mouse.name) , data=mice.df)
waldInterval(model=m.lm,Z=Z,FUN=exp)
C = 5
celltypes[C]
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[C]),maleWT.mice),2)
#
#
# 2019. Took this from mice2.rmd.
#       Fits Bayesian model.
#
#
rm(list = ls())
library(stringr)
setwd("~/Documents/mice")
source('createMatrix.R')
mice <- read.csv("~/Documents/mice/data/mice.csv",header=TRUE)[1:40,]
# number of mice
N <- dim(mice)[1]
C <- 5
celltypes <- getcelltypes(mice)  # from createMiceDF.R
celltype <- celltypes[C]
celltype
library(stringr)
source('createMiceDF.R')
source('waldInterval.R')
celltypes <- getcelltypes(mice)
celltypes <- getcelltypes(mice)  # from createMiceDF.R
celltype <- celltypes[C]
celltype
#
# Creates a dataset with proportions of cells for the given type
#
#
create.df <- function(df,celltype) {
NMatrix = getNMatrix(df=df,celltype=celltype)
RMatrix = getRMatrix(df=df,celltype=celltype)
result <- data.frame(
name = mice$Data.Set,
animal_type = mice$Animal_type,
N_0 = NMatrix[,1],
R_0 = RMatrix[,1],
N_3 = NMatrix[,2],
R_3 = RMatrix[,2],
N_10 = NMatrix[,3],
R_10 = RMatrix[,3],
N_17 = NMatrix[,4],
R_17 = RMatrix[,4],
N_24 = NMatrix[,5],
R_24 = RMatrix[,5],
female = grepl('female',mice$Animal_type),
type_1 = grepl('PLT',mice$Animal_type),
type_2 = grepl('Pound',mice$Animal_type)
)
result$type <- 'WT'
result[which(result$type_1),"type"] <- 'PLT'
result[which(result$type_2),"type"] <- 'Pound'
result <- result[ , !(names(result) %in% c("type_1","type_2"))]
result$y0 <- result$R_0/result$N_0
result$y3 <- result$R_3/result$N_3
result$y10 <- result$R_10/result$N_10
result$y17 <- result$R_17/result$N_17
result$y24 <- result$R_24/result$N_24
return(result)
}
# return proportions for a give mouse row
getPropsByMouse <- function(df,id) {
return(df[id,c("y0","y3","y10","y17","y24")])
}
# returns type of given mouse row
getMouseType <- function(df,mouse) {
return(df$type[mouse])
}
# adds mouse to the plot
#  mouse is the row in the df
#  df would be df.props
addMouseToPlot <- function(mouse,df) {
col <- 'black'
pch <- 20
if (getMouseType(df,mouse) == "Pound") {
col <- 'red'
}
pts <- getPropsByMouse(df,mouse)
points(0,pts[1,1],col=col,pch=pch)
points(3,pts[1,2],col=col,pch=pch)
points(10,pts[1,3],col=col,pch=pch)
points(17,pts[1,4],col=col,pch=pch)
points(24,pts[1,5],col=col,pch=pch)
lines(x=c(0,3,10,17,24),y=pts,col=col,pch=pch)
print(paste(mouse,col,round(pts,2)))
}
addMiceToPlot <- function(mice,df) {
for (i in 1:length(mice)) {
addMouseToPlot(mice[i],df)
}
}
addMeansToPlot <- function(df,theGroup,col) {
lines(c(0,3,10,17,24),apply(getPropsByMouse(df,theGroup),2,mean,na.rm=T),col=col,lty=10,lwd=4)
}
#male.mice <- df.props[which(!df.props$female),]
df.props <- create.df(df = mice,celltype)
maleWT.mice <-
which(!df.props$female & df.props$type == "WT")
#male.mice <- df.props[which(!df.props$female),]
df.props <- create.df(df = mice,celltype)
getRMatrix <- function(df,celltype) {
getColname <- function(num,celltype) {
return(paste(celltype,'pos_',num,sep=''))
}
if (celltype %in% c("CD19pos_B220","CD11c","CD19","CD19pos_B220pos_MHCII","CD11b")) {
days <- c(0,3,10,17,24)
colnames <- days %>% map(getColname,celltype=celltype) %>% unlist
result <- df[,colnames]
colnames(result) <- paste("R_",days,sep="")
return(result)
}
}
#male.mice <- df.props[which(!df.props$female),]
df.props <- create.df(df = mice,celltype)
maleWT.mice <-
which(!df.props$female & df.props$type == "WT")
malePound.mice <-
which(!df.props$female & df.props$type == "Pound")
createDataplot <- function(main,df) {
maleWT.mice <-
which(!df$female & df$type == "WT")
malePound.mice <-
which(!df$female & df$type == "Pound")
ylim <- max(df[c(maleWT.mice,malePound.mice),c("y0","y3","y10","y17","y24")] ,na.rm=T) + 0.05
plot('',xlim=c(0,24),ylim=c(0,ylim),xaxt='n',yaxt='n',
main=main,xlab='day')
xbreaks <- c(0,3,10,17,24)
abline(v=xbreaks,lty=3,col='grey')
abline(h=seq(0,1,0.1),lty=3,col='grey')
axis(side = 1, at=xbreaks)
# ? this does not work
axis(side = 2, at=c(0.1,0.2,0.3,0.4),labels=c(0.1,0.2,0.3,0.4))
addMiceToPlot(maleWT.mice,df)
addMiceToPlot(malePound.mice,df)
addMeansToPlot(df,maleWT.mice,'black')
addMeansToPlot(df,malePound.mice,'red')
}
par(mfrow=c(1,1))
celltypes[C]
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[C]),maleWT.mice),2)
round(getPropsByMouse(df=create.df(df = mice,celltype=celltypes[C]),malePound.mice),2)
createDataplot(main = str_c(celltypes[C]),
df = create.df(df = mice,celltypes[C]))
#
#
# 2019. Took this from mice.df.rmd.
#
#
rm(list = ls())
library(stringr)
library(lme4)
setwd("~/Documents/mice")
source('createMiceDF.R')
source('waldInterval.R')
mice = readFile(filename='data/mice.csv')
celltypes <- getcelltypes(mice)
# get data in long format
C = 4
# get data in long format
C = 5
celltypes[C]
# create dataset in the long format for the given cell type
mice.df <- createMiceDF(celltype = celltypes[C], mice )
head(mice.df)
mice=NULL
dim(mice.df)
# z-value for 95% CI
Z = 1.96
##
## linear model on the logit scale
##
##
m.lm <- lmer(logity ~ type * factor(period) +  (1|mouse.name) , data=mice.df)
waldInterval(model=m.lm,Z=Z,FUN=exp)
mice.df$celltype
r <- residuals(m.lm)
y.sim <- simulate(m.lm,nsim=10)
rsim <- matrix(nrow = dim(y.sim)[1],ncol=10)
for (i in 1:10) {
r <- residuals(lmer( unlist(y.sim[i]) ~ type * factor(period) +  (1|mouse.name) , data=mice.df))
rsim[,i] <- r
}
policePlot(residuals(m.lm),rsim,xl= c(-1,1))
plots(df=mice.df,fit=invlogit(predict(m.lm)),r=r <- residuals(m.lm),qq=T)
celltypes
